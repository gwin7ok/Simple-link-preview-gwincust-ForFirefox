# Simple Link Preview (gwincust)

このアドオンは、「Simple Link Preview」（Lecron氏作）のフォーク・改変版です。  
元のアドオン：https://addons.mozilla.org/ja/firefox/addon/simple-link-preview/  
ライセンス：Mozilla Public License 2.0  

---

このアドオンは、リンクにマウスオーバーするだけでリンク先のプレビューを表示する便利なツールです。リンク先を確認するためにページを離れる必要がなく、効率的にウェブを閲覧できます。

---

## 主な機能

- **リンクプレビュー**: リンクにマウスオーバーするだけでプレビューを表示。
- **プレビューウィンドウの操作**:
  - プレビューウィンドウのサイズ調整。
  - プレビューを新しいタブで開く。
  - プレビューウィンドウを固定または非表示にする。
- **プレビュー機能の ON/OFF**: ツールバーアイコンをクリックしてプレビュー機能を有効または無効に切り替え可能。
- **デバッグモード**: オプション画面でデバッグモードを有効にすると、開発者ツールのコンソールに詳細なログが出力されます。
- **`X-Frame-Options`と`Content-Security-Policy`の無視**:
  - オプション画面でそれぞれの無視設定を有効にすることで、特定のウェブサイトでプレビューがブロックされる問題を回避可能（開発環境でのみ推奨）。
- **アイコンの大きさ設定**:
  - オプション画面でプレビューアイコンの大きさを「小」「中」「大」から選択可能。

---

## オプション画面で設定可能な項目

以下の設定はオプション画面で変更可能です：

- **`iconSize`**: プレビューアイコンの大きさを選択。
  - デフォルト値: `small`（小）
  - 選択肢: `small`（小）、`medium`（中）、`large`（大）
- **`iconDisplayDelay`**: プレビューアイコンの表示遅延時間（ミリ秒）。
  - デフォルト値: `200`
- **`iconDisplayTime`**: プレビューアイコンの表示時間（ミリ秒）。
  - デフォルト値: `2000`
- **`iconDisplayOffsetX`**: プレビューアイコンの表示位置のX軸オフセット。
  - デフォルト値: `-30`
- **`iconDisplayOffsetY`**: プレビューアイコンの表示位置のY軸オフセット。
  - デフォルト値: `-30`
- **`frameDisplayDelay`**: プレビューウィンドウの表示遅延時間（ミリ秒）。
  - デフォルト値: `500`
- **`frameDisplayTime`**: プレビューウィンドウの表示時間（ミリ秒）。
  - デフォルト値: `2000`
- **`frameUpdateTime`**: プレビューウィンドウの更新間隔（ミリ秒）。
  - デフォルト値: `200`
- **`bodyRightMarginWidthPx`**: プレビューウィンドウ表示時の右マージン幅（ピクセル）。
  - デフォルト値: `800`
- **`previewWidthPx`**: プレビューウィンドウの幅（ピクセル）。
  - デフォルト値: `800`
- **`ignoreXFrameOptions`**: `X-Frame-Options`ヘッダーを無視するかどうか。
  - デフォルト値: `false`
- **`ignoreContentSecurityPolicy`**: `Content-Security-Policy`ヘッダーを無視するかどうか。
  - デフォルト値: `false`
- **`debugMode`**: デバッグモードを有効にするかどうか。
  - デフォルト値: `false`
- **`urlFilterList`**: プレビューを無視するURL文字列のリスト（改行区切り）。
  - デフォルト値: 空文字列
- **`keepPreviewFrameOpen`**: プレビューウィンドウを常に固定するかどうか。
  - デフォルト値: `false`

---

## インストール方法

このアドオンを Firefox にインストールするには、以下の手順を実行してください：

1. **リポジトリをダウンロードする**
   - このページの右上にある「<> Code」ボタンをクリックします。
   - 表示されたメニューから「Download ZIP」を選択して、ファイルをダウンロードします。

2. **ZIPファイルを解凍する**
   - ダウンロードした ZIP ファイルを解凍します。
   - 解凍すると、フォルダが作成されます（例: `Simple-link-preview-gwincust-main`）。

3. **フォルダ内のファイルを準備する**
   - 解凍してできたフォルダを開きます。
   - フォルダ内にあるすべてのファイルとフォルダを選択します（`Ctrl + A` または `Command + A` を使用）。
   - 選択したファイルを ZIP 形式で再圧縮します。
     - 圧縮する際、フォルダ全体を ZIP にするのではなく、フォルダ内のファイルとフォルダだけを ZIP にしてください。

4. **ZIPファイルの拡張子を変更する**
   - 作成した ZIP ファイルの拡張子を `.zip` から `.xpi` に変更します。
     - 例: `addon.zip` → `addon.xpi`
   - 拡張子を変更する際に警告が表示される場合は「はい」または「OK」を選択してください。

5. **Firefox にインストールする**
   - 作成した `.xpi` ファイルを Firefox のウィンドウにドラッグ＆ドロップします。
   - インストール確認のダイアログが表示されるので、「インストール」をクリックします。

6. **ツールバーアイコンを確認する**
   - インストール後、通常はツールバーにアドオンのアイコンが表示されます。
   - **もしアイコンが表示されない場合**:
     1. Firefox の右上にあるジグゾーパズルアイコン（拡張機能）をクリックします。
     2. 「Simple Link Preview gwincust」の右にある歯車アイコンをクリックします。
     3. 「ツールバーにピン留め」を選択します。
   - これでツールバーにアドオンのアイコンが表示されます。

---

これでアドオンがインストールされます。

---

## 使用方法

1. アドオンをインストールすると、ツールバーにアイコンが表示されます。
2. アイコンをクリックしてプレビュー機能を有効または無効に切り替えます。
3. リンクにマウスオーバーすると、リンク先のプレビューが表示されます。
   - アクティベーションモードを「withKey」に設定している場合は、指定したキー（デフォルトはShift）を押しながらマウスオーバーしてください。
4. プレビューウィンドウは以下の方法で操作できます：
   - クリック：リンク先を新しいタブで開く
   - エスケープキー：プレビューを閉じる
5. オプション画面で設定を変更することで、動作をカスタマイズできます。

---

## 改善された機能

- **フォーカス管理の最適化**: Firefoxウィンドウのフォーカス状態に応じてプレビューの動作を制御し、YouTubeなどの特殊なサイトでの表示問題を改善。
- **メッセージング処理の安定化**: バックグラウンドスクリプトとコンテンツスクリプト間の通信を最適化し、安定性を向上。
- **アクティベーションモード**: 常時またはキー押下時のみプレビューを表示するモードを選択可能に。

---

## 注意事項

- **`X-Frame-Options`と`Content-Security-Policy`の無視**:
  - この機能は開発環境でのデバッグ目的でのみ使用してください。本番環境での使用は推奨されません。
  - サーバーのセキュリティポリシーを回避する行為は、法的・倫理的な問題を引き起こす可能性があります。

---

## ライセンス

このプロジェクトは、元のアドオンのライセンスに従います。
Mozilla Public License 2.0